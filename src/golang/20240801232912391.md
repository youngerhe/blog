---
title: WebRTC（一）：概念
category:
  - golang
date: 2024-08-01
tag:
  - golang
  - webrtc
  - turn
---

# WebRTC（一）：概念

## 一、介绍

**WebRTC 是一种实现网页或应用程序之间实时音视频通信的先进技术**。

**WebRTC，全称 Web Real-Time Communication，是一项开源技术，它允许不同平台和浏览器之间在无需中间媒介的情况下建立直接的点对点连接。这项技术被广泛应用于视频会议、文件传输、聊天以及桌面共享等场景，其便捷性和高效性使其成为现代通信解决方案的重要组成部分。**

**WebRTC 的技术基础包括多个关键组件。首先是媒体捕获与流处理，这一模块负责从用户的设备（如摄像头和麦克风）捕获音频和视频数据，并将这些数据进行编码、解码、处理回声消除及降噪等操作。其次是信号传输方面，涉及数据压缩、封装以及处理网络延迟、丢包等问题，通过实现 STUN、TURN 等协议来解决 NAT 穿越问题，确保在不同网络环境下顺畅通信。**

**信令机制在 WebRTC 中也扮演着至关重要的角色。信令用于在通信双方之间建立和协调连接，例如交换媒体配置信息和协调网络地址及端口等信息。开发者可以根据具体应用需求选择或实现合适的信令协议，如 WebSocket、XMPP 或 SIP。此外，WebRTC 还提供了数据通道功能，用于直接在两个点之间传输任意数据，进一步扩大了其应用场景。**

**综上所述，WebRTC 不仅在技术上具有先进性，而且在用户体验上也进行了优化，其高度集成化和跨平台的特性使其成为实现实时音视频通信的理想选择。通过深入理解其基础架构及关键技术组件，开发者可以更加灵活地利用 WebRTC，为用户提供高效、安全、流畅的通信体验。**

## 二、知识收集整理

- **简介**
  - **实时通讯技术，建立浏览器点对点通信**
  - **IM 即时通信，文字聊天、语音、文件传输。考虑的是可靠性**
  - **RTC 实时通信：音频童话、电话会议。考虑的是低延迟**
  - **除了 IE 浏览器 都支持 webRTC**
  - **内置强大的音视频引擎，如：媒体流编解码、回声消除、降噪、防抖**
- **组成**
  - **浏览器 API**
    - **getUserMedia：获取麦克风许可**
    - **RTCPeerConnection 提供创建、保持、监控、关闭链接的实现**
    - **RTCDataChannel：支持点对点传输，可以传输文件。文本消息等**
  - **音视频引擎**
    - **音频：G711/OPUS 编解码、回音消除、降噪**
    - **视频：H264/Vp8 编解码、图像增强、Jitter Buffer**
  - **网络 I/O**
    - **RTP/SRTP：传输视频流失 先加一个 RTP 头在交给 UDP，SRTP 是加密协议，更安全**
    - **RTCP：通过 RTCP 可以知道各端的网络质量，这样就可以做流控处理**
    - **P2P（ICE+STUN+TURN）：核心技术，利用 ICE、STUN、TURN 等技术 实现浏览器点对点链接，解决 NAC 穿透问题，实现高质量网络传输。**
    - **信令服务：实现可控的开启关闭视频传输指令**
    - **STUN 协议:遵守这个协议就可以拿到自己的公网 ip。免费：stun.l.google.com：19302**
    - **TURN 协议：与 STUN 的共同点是都通过修改应用层中的私网地址打到 NAT 穿透的效果，异同点是 TURN 是通过两方通讯的中间人方式实现穿透**
- **通信过程**
  - **条件**
    - **两个 WebRTC 终端**
    - **Signal 信令服务器**
    - **stun/turn 服务器 负责 WebRTC 终端在公网的 IP 地址。以及 NAT 穿越失败后的数据中转**
    - **WebRTC 相关 api 需要 https 或者 localhost**
  - **过程**
    - **A 端设备检测，开启采集**
    - **准备就绪，发送指令到 signal 服务器**
    - **signal 创建服务器**
    - **B 端同样操作，加入房间，通知另一端**
    - **双端创建媒体链接对象 RTCPeerConnection。进行媒体协商**
    - **双端进行连通性测试，建立连接**
    - **将采集视频数据通过 RTCPeerConnection 对象进行编码，最终通过 P2P 传送给对端解码展示**
- **实操**
  - **采集**
    - **const constraints = { video: true, audio: true }\nconst localStream = navigator.mediaDevices.getUserMedia(constraints)**
  - **设备信息**
    - **console.log(navigator.mediaDevices.enumerateDevices())**
  - **信令服务器**
    - **ws**
  - **媒体协商**
    - **RTCPeerConnection ：找到双方共同支持的媒体能力**
  - **收集 Candidate**
    - **获取 ip、端口、候选者类型、优先级、传输协议、服务昵称等信息**
    - **候选者：host>srflx>relay（TURN 联通率最高，优先级最低）**

![webRTC](/assets/images/20240801232912391.png)
